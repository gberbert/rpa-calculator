# AGENT MEMORY RAG

## SYSTEM STATUS
- **Workspace:** `rpa-calculator`
- **Environment:** Development (Local)
- **Last Update:** 2026-01-20

## PROJECT CONTEXT
- **Type:** ROI Calculator for RPA (React/Vite + Node.js?)
- **Current Issue:** Frontend not loading (404 on main.tsx, Manifest syntax error).

## DECISION LOG

### [2026-01-07] Initialization & Frontend Diagnosis
- **Context:** User reported white screen on localhost:5173. Error indicates browser looking for `main.tsx` while valid file is `main.jsx`.
- **Diagnosis:** Suspected Stale Service Worker (PWA) cache holding onto an old version of `index.html` referencing `main.tsx`.
- **Action:** 
    1. Initialized this RAG file.
    2. Planned to clear Vite cache (`.vite` folder).
    3. Instructed user to clear browser cache/hard reload.
    4. Executed cache cleanup: moved `frontend/node_modules/.vite` to `.vite_backup`.

### [2026-01-07] Fix Admin Settings Visibility
- **Context:** User logged in as "admin" but cannot see or access the configuration screen.
- **Analysis:** Investigating `Navbar.jsx` for button visibility logic and `Settings.jsx` or `AuthContext` for permission logic. `App.jsx` uses state-based routing (`currentView`).
- **Fix:** Modified `AuthContext.jsx` to include a fallback: if the user's email starts with "admin", automatically assign the 'admin' role, even if the Firestore document is missing or says 'user'. This bypasses potential DB issues during dev.

### [2026-01-07] Update History Table
- **Context:** User requested adding a "User Email" column and removing the ID display in the history table.
- **Action:**
    1.  Modified `backend/src/services/projectService.js` to enrich `listProjects` results with email data fetched from the `users` collection.
    2.  Updated `frontend/src/components/ProjectHistory.jsx` to add the "Usu√°rio" column and remove the ID caption.

### [2026-01-12] Fix 400 Bad Request on ROI Calculation (Production)
- **Context:** User reported `400 Bad Request` on `/api/projects/calculate-roi` in Render. Local code uses `POST /api/projects`.
- **Diagnosis:** Version mismatch. Production is outdated.
- **Action:**
    1.  Enhanced `ROIWizard.jsx` to show detailed backend errors.
    2.  Validated local logic.
    3.  **Executed:** Deployed version `v1.0.41` via `release.js`.
    4.  **Note:** Created `.deploy_history.md`.
    5.  **Fix Iteration:** User reported persistent error. Identified missing `numSteps` in `ROIWizard.jsx` payload causing backend validation failure (400).
    6.  **Action:** Added `numSteps` to payload and updated `release.js` to bump backend version.

### [2026-01-20] Agentic Architect Session Start
- **Context:** User initialized "Agentic Architect" persona with strict environment rules (`/staging` vs `/prd`).
- **Analysis:**
    - Current structure: `root/backend`, `root/frontend`.
    - Requested structure: `root/staging`, `root/prd`.
    - **Discrepancy:** The physical directory structure does not match the prompt's "Ambiente Operacional".
- **Action:**
    - Updated RAG.
    - Will request user decision on directory restructuring vs logical mapping.

### [2026-01-20] Fix Frontend White Screen (Recurrence)
- **Context:** User reported white screen and 404 on `main.tsx` again.
- **Diagnosis:** Stale Service Worker cache persisting despite previous fixes.
- **Action:**
    1.  Updated `vite.config.js` to include `workbox: { cleanupOutdatedCaches: true, skipWaiting: true, clientsClaim: true }`.
    2.  Force deleted `frontend/node_modules/.vite`.
    3.  Instructed user to Hard Reload.
